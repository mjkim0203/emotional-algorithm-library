<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>감정 분석 결과</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <link rel="stylesheet" href="tri.joy.css" />
</head>
<body>

  <!-- 상단 롤링바 -->
  <div class="top-bar">
    <div class="scroll-wrapper">
      <div class="scroll-text">
        HOW ALGORITHM U FEELING TODAY?&nbsp;&nbsp;&nbsp; HOW ALGORITHM U FEELING TODAY?&nbsp;&nbsp;&nbsp; HOW ALGORITHM U FEELING TODAY?
      </div>
    </div>
  </div>

  <!-- 메인 화면 컨테이너 -->
  <div class="screen-container">
    
    <!-- 화면1 : 분석 중 + 완료 -->
    <div class="screen screen1 show">
      <div class="title" id="title">감정 분석하는 중 . . .</div>
      <div class="subtitle" id="subtitle">지금 감정을 분석하고 있어요</div>

      <div class="circles">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
      </div>

      <div class="emotion-eng-wrapper" id="emotionEngWrapper">
        <img src="https://cdn.glitch.global/b5dd1b0e-2595-4522-b3c9-fac2d8d11eb4/CAPTURE-200.png?v=1751441486667" alt="left bracket" class="bracket-img left">
        <div class="emotion-eng" id="emotionEng">Joy</div>
        <img src="https://cdn.glitch.global/b5dd1b0e-2595-4522-b3c9-fac2d8d11eb4/CAPTURE-200.png?v=1751441486667" alt="right bracket" class="bracket-img right">
      </div>

      <!-- ✅ 프로그레스 바는 화면1 내부에 고정 -->
      <div class="progress-wrapper">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <!-- 화면2 : 사용자 정보 -->
    <div class="background-image"></div>
    <div class="gradient-overlay"></div>

    <div class="screen screen2">
      <div class="notice-text">이제 다음 단계로 넘어가주세요!</div>

      <!-- 감정 그래픽 -->
      <div class="graphic-box">
        <img src="https://i.ibb.co/p6FpvtBx/GRAPHIC-200.png" alt="emotion graphic" class="graphic-img" />
      </div>

      <!-- 사용자정보 -->
      <div class="info-block">
        <div class="info-row">
          <img src="https://i.ibb.co/yn7TGRSj/g-200.png" class="emoji-img" />
          <div class="label">User Name</div>
        </div>
        <div class="value" id="user-name">이름</div>

        <div class="divider"></div>

        <div class="info-row">
          <img src="https://i.ibb.co/yn7TGRSj/g-200.png" class="emoji-img" />
          <div class="label">Emotion</div>
        </div>
        <div class="value emotion-value" id="emotion-ko">기쁨</div>


     <div class="page-buttons">
           <button onclick="location.href='index.html'" class="home-button">← home</button>
          <button data-video-src="videos/joy.mp4 " 
                   data-audio-src="audio/joy.mp3"
class="next-button"
        onclick="sendMQTTMessageAndGoNext()">
  next →
</button>
        </div>
   
       <audio id="triggerAudio" preload="auto"></audio>


      </div>
    </div>
  </div>

  <!-- ✅ 하단 고정 로고만 별도로 -->
  <div class="fixed-logo">
    <img src="https://i.ibb.co/JWZj7K9v/LOGO-1.png" class="logo-img" />
  </div>

<!-- 1) Paho MQTT WebSocket 클라이언트 -->
 <script src="js/paho-mqtt.min.js"></script>
  <!-- 2) TTContainer 래퍼 -->
  <script src="js/TTContainer.js"></script>

  <script>
    // ✅ MQTT 연결 초기화
    window.addEventListener('load', () => {
    ttContainer.mqttConnect(
      "sample",
      "display",
      () => console.log("✅ MQTT 연결 완료 (tri.fear.html)"),
      { brokerUrl: "wss://broker.emqx.io:8084/mqtt" }
    );
  });

  function sendMQTTMessageAndGoNext() {
    const url = "https://mjkim0203.github.io/emotional-algorithm-library/videos/joy.mp4";
    ttContainer.sendMessage(url);
    console.log("✅ MQTT 메시지 전송됨:", url);
  }

const cursor = document.createElement("img");
cursor.className = "cursor-image";
document.body.appendChild(cursor);
cursor.src = defaultCursor;

// 이미지 경로
const defaultCursor = "/mnt/data/default.png";
const whiteCursor = "/mnt/data/white.png";
const hoverCursor = "/mnt/data/hover.png";

// 임시 캔버스 생성 (픽셀 색상 확인용)
const canvas = document.createElement("canvas");
canvas.width = 1;
canvas.height = 1;
const ctx = canvas.getContext("2d");

document.addEventListener("mousemove", (e) => {
  cursor.style.left = ${e.clientX}px;
  cursor.style.top = ${e.clientY}px;

  const elem = document.elementFromPoint(e.clientX, e.clientY);

  if (!elem) return;

  // 1️⃣ hover 대상이 우선
  if (elem.closest(".cursor-hover-target")) {
    cursor.src = hoverCursor;
    return;
  }

  // 2️⃣ 배경색 계산
  const computedStyle = getComputedStyle(elem);
  const bgColor = computedStyle.backgroundColor;

  const rgb = bgColor.match(/\d+/g)?.map(Number);
  if (!rgb || rgb.length < 3) {
    cursor.src = defaultCursor; // fallback
    return;
  }

  const [r, g, b] = rgb;
  const brightness = (r * 299 + g * 587 + b * 114) / 1000;

  // 기준치: 128보다 작으면 어두운 배경
  cursor.src = brightness < 128 ? whiteCursor : defaultCursor;
});
    
    
  </script>



  <script src="trigger.js"></script>
  <script src="socket.js"></script>

</body>
</html>
