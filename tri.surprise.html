<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>감정 분석 결과</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <link rel="stylesheet" href="tri.surprise.css" />
 <style>
    .cursor-image {
      position: fixed;
      width: 50px;
      height: 50px;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      mix-blend-mode: difference;
    }
  </style>
</head>
<body>

  <!-- 상단 롤링바 -->
  <div class="top-bar">
    <div class="scroll-wrapper">
      <div class="scroll-text">
        HOW ALGORITHM U FEELING TODAY?&nbsp;&nbsp;&nbsp; HOW ALGORITHM U FEELING TODAY?&nbsp;&nbsp;&nbsp; HOW ALGORITHM U FEELING TODAY?
      </div>
    </div>
  </div>

  <!-- 메인 화면 컨테이너 -->
  <div class="screen-container">
    
    <!-- 화면1 : 분석 중 + 완료 -->
    <div class="screen screen1 show">
      <div class="title" id="title">감정 분석하는 중 . . .</div>
      <div class="subtitle" id="subtitle">지금 감정을 분석하고 있어요</div>

      <div class="circles">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
      </div>

      <div class="emotion-eng-wrapper" id="emotionEngWrapper">
        <img src="https://cdn.glitch.global/b5dd1b0e-2595-4522-b3c9-fac2d8d11eb4/CAPTURE-700.png?v=1751441522643
" alt="left bracket" class="bracket-img left">
        <div class="emotion-eng" id="emotionEng">Surprise</div>
        <img src="https://cdn.glitch.global/b5dd1b0e-2595-4522-b3c9-fac2d8d11eb4/CAPTURE-700.png?v=1751441522643
" alt="right bracket" class="bracket-img right">
      </div>

      <!-- ✅ 프로그레스 바는 화면1 내부에 고정 -->
      <div class="progress-wrapper">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <!-- 화면2 : 사용자 정보 -->
    <div class="background-image"></div>
    <div class="gradient-overlay"></div>

    <div class="screen screen2">
      <div class="notice-text">이제 다음 단계로 넘어가주세요!</div>

      <!-- 감정 그래픽 -->
      <div class="graphic-box">
        <img src="https://i.ibb.co/gZFSSYYV/GRAPHIC-700.png" alt="emotion graphic" class="graphic-img" />
      </div>

      <!-- 사용자정보 -->
      <div class="info-block">
        <div class="info-row">
          <img src="https://i.ibb.co/LhcLGmcs/g-700.png" class="emoji-img" />
          <div class="label">User Name</div>
        </div>
        <div class="value" id="user-name">이름</div>

        <div class="divider"></div>

        <div class="info-row">
          <img src="https://i.ibb.co/LhcLGmcs/g-700.png" class="emoji-img" />
          <div class="label">Emotion</div>
        </div>
        <div class="value emotion-value" id="emotion-ko">놀람</div>


      <div class="page-buttons">
           <button onclick="location.href='index.html'" class="home-button">← home</button>
           <button data-video-src="videos/surprise.mp4 " 
                   data-audio-src="audio/surprise.mp3"
class="next-button cursor-hover-target"
        onclick="sendMQTTMessageAndGoNext()">
  next →
</button>
        </div>
   
       <audio id="triggerAudio" preload="auto"></audio>


      </div>
    </div>
  </div>

  <!-- ✅ 하단 고정 로고만 별도로 -->
  <div class="fixed-logo">
    <img src="https://i.ibb.co/JWZj7K9v/LOGO-1.png" class="logo-img" />
  </div>

<!-- 1) Paho MQTT WebSocket 클라이언트 -->
<script src="js/paho-mqtt.min.js"></script>
  <!-- 2) TTContainer 래퍼 -->
  <script src="js/TTContainer.js"></script>

<!-- 커서 + MQTT -->  
<script>
const defaultCursor = "assets/default.png";
    const whiteCursor   = "assets/white.png";
    const hoverCursor   = "assets/hover.png";

    const cursor = document.createElement("img");
    cursor.className = "cursor-image";
    cursor.src = defaultCursor;
    document.body.appendChild(cursor);

    // 마우스 커서 처리
    document.addEventListener("mousemove", (e) => {
      cursor.style.left = `${e.clientX}px`;
      cursor.style.top = `${e.clientY}px`;

      const elem = document.elementFromPoint(e.clientX, e.clientY);
      if (!elem) return;

      if (elem.closest(".cursor-hover-target")) {
        cursor.src = hoverCursor;
        return;
      }

      const bgColor = getComputedStyle(elem).backgroundColor;
      const rgb = bgColor.match(/\d+/g)?.map(Number);
      if (!rgb || rgb.length < 3) {
        cursor.src = defaultCursor;
        return;
      }

      const [r, g, b] = rgb;
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      cursor.src = brightness < 128 ? whiteCursor : defaultCursor;
    });

  
   // ✅ MQTT 연결 및 메시지 전송
  window.addEventListener('load', () => {
    ttContainer.mqttConnect(
      "sample",
      "display", // 현재 코드 유지 (TTContainer가 문자열을 허용하는 경우)
      () => {
        console.log("✅ MQTT 연결 완료 (tri.joy.html)");
      },
      {
        // ✅ 자동 페일오버: EMQX → HiveMQ → Mosquitto
        brokers: [
          { type: "url", url: "wss://broker.emqx.io:8084/mqtt" },
          { type: "url", url: "wss://broker.hivemq.com:8884/mqtt" },
          { type: "url", url: "wss://test.mosquitto.org:8081/mqtt" }
        ]
      }
    );
  });

  function sendMQTTMessageAndGoNext() {
    const url = "https://mjkim0203.github.io/emotional-algorithm-library/videos/surprise.mp4";
    ttContainer.sendMessage(url);
    console.log("✅ MQTT 메시지 전송됨:", url);
  }

  
  
  </script>


  <script src="trigger.js"></script>
  <script src="socket.js"></script>

</body>
</html>
